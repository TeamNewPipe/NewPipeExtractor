// Created by Fynn Godau 2019, licensed GNU GPL version 3 or later

package org.schabi.newpipe.extractor.services.bandcamp.stream;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;
import org.schabi.newpipe.downloader.DownloaderFactory;
import org.schabi.newpipe.extractor.NewPipe;
import org.schabi.newpipe.extractor.exceptions.ParsingException;
import org.schabi.newpipe.extractor.services.bandcamp.linkHandler.BandcampStreamLinkHandlerFactory;

import java.io.IOException;

import static org.junit.jupiter.api.Assertions.*;

/**
 * Test for {@link BandcampStreamLinkHandlerFactory}
 */
public class BandcampStreamLinkHandlerFactoryTest {

    private static final String RESOURCE_PATH = DownloaderFactory.RESOURCE_PATH + "services/bandcamp/extractor/linkHandler/stream";
    private static BandcampStreamLinkHandlerFactory linkHandler;

    @BeforeAll
    public static void setUp() throws IOException {
        NewPipe.init(DownloaderFactory.getDownloader(RESOURCE_PATH));
        linkHandler = BandcampStreamLinkHandlerFactory.getInstance();
    }

    @Test
    public void testGetRadioUrl() throws ParsingException {
        assertEquals("https://bandcamp.com/?show=1", linkHandler.getUrl("1"));
    }

    @Test
    public void testGetRadioId() throws ParsingException {
        assertEquals("2", linkHandler.getId("https://bandcamp.com/?show=2"));
    }

    @Test
    public void testAcceptUrl() throws ParsingException {
        assertFalse(linkHandler.acceptUrl("http://interovgm.com/releases/"));
        assertFalse(linkHandler.acceptUrl("https://interovgm.com/releases"));
        assertFalse(linkHandler.acceptUrl("http://zachbenson.bandcamp.com"));
        assertFalse(linkHandler.acceptUrl("https://bandcamp.com"));
        assertFalse(linkHandler.acceptUrl("https://zachbenson.bandcamp.com/"));
        assertFalse(linkHandler.acceptUrl("https://powertothequeerkids.bandcamp.com/album/power-to-the-queer-kids"));
        assertFalse(linkHandler.acceptUrl("https://example.com/track/sampletrack"));

        assertTrue(linkHandler.acceptUrl("https://zachbenson.bandcamp.com/track/kitchen"));
        assertTrue(linkHandler.acceptUrl("http://ZachBenson.Bandcamp.COM/Track/U-I-Tonite/"));
        assertTrue(linkHandler.acceptUrl("https://interovgm.bandcamp.com/track/title"));
        assertTrue(linkHandler.acceptUrl("http://bandcamP.com/?show=38"));
        assertTrue(linkHandler.acceptUrl("https://goodgoodblood-tl.bandcamp.com/track/when-it-all-wakes-up"));
        assertTrue(linkHandler.acceptUrl("https://lobstertheremin.com/track/unfinished"));
    }
}
